<!DOCTYPE HTML><html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta content="text/html;charset=utf-8" http-equiv="Content-Type">
    <link rel="stylesheet"
	  href="https://use.fontawesome.com/releases/v5.7.2/css/all.css"
	  integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr"
	  crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="esp.css">

    <title>ESP32</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  </head>
  
  <body>
    <h1>ESP32</h1>
    <h3>Object status :</h3>
    Uptime      : %UPTIME% s<br/>
    Where       : %WHERE% s<br/>

    <h3>Network link status :</h3>
    WiFi SSID   : %SSID%<br/>
    MAC address : %MAC%<br/>
    IP address  : %IP%<br/>

    <h3>Sensors status :</h3>
    Temperature : %TEMPERATURE% C<br/>
    Light       : %LIGHT% Lumen<br/>
    Cooler      : %COOLER%<br/>
    Heater      : %HEATER%<br/>

    <h3>Sensors status WITH GLYPHS :</h3>
    <div class="grid-container">
      <div class="grid-item">
	<i class="fas fa-thermometer-half" style="color:#059e8a;"></i>
      </div>
      <div class="grid-item">      
	<span class="sensors-labels">Temperature</span> 
	<span id="temperature">%TEMPERATURE%</span>
	<sup class="units">&deg;C</sup>
      </div>
      <div class="grid-item">
	<i class="far fa-lightbulb" style="color:#00add6;"></i>
      </div>
      <div class="grid-item">
	<span class="sensors-labels">Light</span>
	<span id="light">%LIGHT%</span>
	<sup class="units">Lumen</sup>
      </div>
    </div>
    
    <h3>Temp. Regul. Thresholds :</h3>
    Low Temp  : %LT% C<br/>
    High Temp : %HT% C<br/>

    <h3> Periodic status report to :</h3>
      <label for="ip">IP Address :</label>
      <input id="target_ip" type="text" name="ip" placeholder="%PRT_IP%"/><br/>
      <label for="port">Port :</label>
      <input id="target_port" type="text" name="port" placeholder="%PRT_PORT%"/><br/>
      <label for="sp"> Sampling Period (in seconds) :</label>
      <input id="sp" type="text" name="sp" placeholder="%PRT_T%"/><br/>
      <input type="submit" value="Change reporting host !"/>
      <button id="monBouton">Cliquez ici</button>

    <script>
      // The last version should use fetch API instead of XMLHttpRequest() 
      // my proposal with help from
      // https://developer.mozilla.org/en-US/docs/Learn/JavaScript/Client-side_web_APIs/Fetching_data
      // https://rapidapi.com/guides/api-requests-intervals
      // https://medium.com/codingurukul/fetch-api-a-modern-replacement-for-xmlhttprequest-c24ced9ff8d3

      /*
      function startUpdate(sensor){
	  setInterval(function () {
	      fetch(sensor)
	      // fetch() returns a promise. When we have received a response from the server,
	      // the promise's `then()` handler is called with the response.
		  .then( function (response) {
		      // Our handler throws an error if the request did not succeed.
		      if (!response.ok) {
			  throw new Error(`HTTP error: ${response.status}`);
		      }
		      // Otherwise (if the response succeeded), our handler fetches the response
		      // as text by calling response.text(), and immediately returns the promise
		      // returned by `response.text()`.
		      return response.text();
		  })
	      // When response.text() has succeeded, the `then()` handler is called with
	      // the text, and we copy it into the `temperature' id.
		  .then(function (text){
		      document.getElementById(sensor).innerHTML = text;
		  })
	      // Catch any errors that might happen, and display a message
	      // in the navigator console.
		  .catch(function (error){
		      console.log(error);		
		  });
	  }, 2000);
      }
      
      document.addEventListener('DOMContentLoaded', function() {
	  startUpdate('temperature');
	  startUpdate('light');
      });
*/

    </script>
    <script>
      var bouton = document.getElementById("monBouton");
      // Ajoutez un gestionnaire d'événements pour le clic
      bouton.addEventListener("click", function() {
// Récupérer les valeurs des champs du formulaire
var target_ip = document.getElementById("target_ip").value;
    var target_port = document.getElementById("target_port").value;
    var sp = document.getElementById("sp").value;
    
// Créer un objet avec les données à envoyer
var data = {
        target_ip: target_ip,
        target_port: target_port,
        sp: sp
    };

    // Envoyer les données au serveur en utilisant une requête AJAX
    $.ajax({
        type: "POST",
        url: "http://172.20.10.8/setNetwork",
        contentType: "application/json",
        data: JSON.stringify(data),
        success: function(response) {
            console.log("Données envoyées avec succès !");
            console.log(response);
        },
        error: function(error) {
            console.error("Erreur lors de l'envoi des données au serveur : " + error);
        }
    });


});




    </script>

    
  </body>
</html>

